{
  "id": "dns-domains",
  "title": "DNS, Domains & Dynamic DNS",
  "slug": "dns-domains",
  "overview": "Learn how DNS works, how to point a domain name to your server, and use Dynamic DNS (DDNS) to handle changing IP addresses from your ISP.",
  "objectives": [
    "Understand how DNS translates domain names to IP addresses",
    "Configure A and CNAME records to point to your server",
    "Set up Dynamic DNS for residential connections with changing IPs",
    "Understand TTL and DNS propagation"
  ],
  "prerequisites": [
    "Completed 'Router Basics & Port Forwarding'",
    "Understanding of IP addresses",
    "Access to a domain name (or willingness to register one)"
  ],
  "durationMinutes": 50,
  "order": 3,
  "sections": [
    {
      "type": "reading",
      "title": "How DNS Works",
      "content": "# Domain Name System (DNS)\n\nDNS is like the phone book of the internet. It translates human-readable domain names into IP addresses.\n\n## The DNS Lookup Process\n\n```\nUser types: example.com\n  ↓\nBrowser checks cache\n  ↓\nQueries DNS Resolver (ISP)\n  ↓\nQueries Root Server → TLD Server (.com) → Authoritative Name Server\n  ↓\nReturns IP: 93.184.216.34\n  ↓\nBrowser connects to that IP\n```\n\n## Key DNS Record Types\n\n- **A Record**: Points domain to IPv4 address\n  - `example.com → 93.184.216.34`\n  \n- **AAAA Record**: Points domain to IPv6 address\n  - `example.com → 2001:0db8:85a3::8a2e:0370:7334`\n  \n- **CNAME Record**: Alias one domain to another\n  - `www.example.com → example.com`\n  \n- **MX Record**: Mail server\n  - `example.com → mail.example.com`\n\n- **TXT Record**: Arbitrary text (used for verification, SPF, etc.)\n\n## TTL (Time To Live)\n\nTTL tells DNS resolvers how long to cache the record (in seconds):\n- **Low TTL (300s)**: Changes propagate quickly, but more DNS queries\n- **High TTL (86400s)**: Less DNS traffic, but changes take longer to propagate\n\n## The Dynamic IP Problem\n\nMost residential ISPs assign **dynamic IP addresses** - your public IP can change!\n\nSolution: **Dynamic DNS (DDNS)**",
      "links": []
    },
    {
      "type": "guide",
      "title": "Setting Up Your Domain and DDNS",
      "content": "# Configuring DNS for Your Server\n\n## Option 1: Static IP (Business/VPS)\n\nIf you have a static IP:\n\n1. **Register a domain** (Namecheap, Google Domains, Cloudflare)\n2. **Add an A record:**\n   ```\n   Type: A\n   Name: @ (or subdomain like 'dev')\n   Value: YOUR_PUBLIC_IP\n   TTL: 3600\n   ```\n3. **Add a CNAME for www:**\n   ```\n   Type: CNAME\n   Name: www\n   Value: yourdomain.com\n   TTL: 3600\n   ```\n4. **Wait for propagation** (5 minutes to 48 hours, usually ~1 hour)\n5. **Test:** `nslookup yourdomain.com`\n\n## Option 2: Dynamic IP (Residential)\n\nIf your IP changes:\n\n1. **Sign up for a DDNS service:**\n   - Free: DuckDNS, No-IP, FreeDNS\n   - Paid: Dynu, Cloudflare (with API)\n   \n2. **Example with DuckDNS:**\n   - Sign up at duckdns.org\n   - Create a subdomain: `myserver.duckdns.org`\n   - Get your token\n   - Install update client on your server:\n   \n   ```bash\n   # Create update script\n   echo url=\"https://www.duckdns.org/update?domains=myserver&token=YOUR_TOKEN&ip=\" | curl -k -o ~/duckdns/duck.log -K -\n   ```\n   \n3. **Automate updates:**\n   - **Linux:** Add to crontab: `*/5 * * * * ~/duckdns/duck.sh`\n   - **Windows:** Use Task Scheduler\n   - **Router:** Some routers have built-in DDNS clients\n\n## Using Your Own Domain with DDNS\n\nYou can point your own domain to a DDNS hostname:\n\n```\nType: CNAME\nName: server\nValue: myserver.duckdns.org\nTTL: 300 (low for frequent IP changes)\n```\n\nNow `server.yourdomain.com` points to your dynamic IP!",
      "links": []
    }
  ],
  "resources": [
    {
      "title": "How DNS Works (Comic)",
      "url": "https://howdns.works/",
      "type": "article",
      "description": "Fun, illustrated guide to DNS"
    },
    {
      "title": "DuckDNS - Free Dynamic DNS",
      "url": "https://www.duckdns.org/",
      "type": "tool",
      "description": "Simple, free DDNS service"
    },
    {
      "title": "DNS Propagation Checker",
      "url": "https://www.whatsmydns.net/",
      "type": "tool",
      "description": "Check DNS propagation across the world"
    },
    {
      "title": "Cloudflare DNS Documentation",
      "url": "https://developers.cloudflare.com/dns/",
      "type": "documentation",
      "description": "Managing DNS with Cloudflare (recommended for production)"
    }
  ],
  "miniProject": {
    "title": "Custom Domain with Dynamic DNS",
    "description": "Set up a domain name for your server using Dynamic DNS, even if your ISP gives you a changing IP address.",
    "estimatedTime": 60,
    "steps": [
      "Sign up for a DDNS service (DuckDNS recommended for beginners)",
      "Create a DDNS hostname (e.g., myserver.duckdns.org)",
      "Install and configure the DDNS update client",
      "Set up automatic updates (cron job, scheduled task, or router)",
      "Test that your DDNS hostname resolves to your current IP",
      "Optional: Point your own domain to the DDNS hostname using CNAME",
      "Update your server to use the domain name instead of IP",
      "Test access via the domain name"
    ],
    "deliverables": [
      "Working DDNS hostname that always points to your current IP",
      "Automated update script/schedule",
      "Server accessible via domain name",
      "Documentation of your DNS configuration"
    ],
    "rubric": [
      "DDNS hostname configured and working (3 pts)",
      "Automatic IP updates set up (2 pts)",
      "Server accessible via domain name (3 pts)",
      "Optional: Custom domain CNAME configured (2 pts, bonus)"
    ],
    "starterPath": "/practice/server-starters/ddns-setup"
  },
  "quiz": {
    "passingScore": 70,
    "questions": [
      {
        "id": "q1",
        "type": "single",
        "question": "What does DNS stand for?",
        "options": [
          "Domain Network System",
          "Domain Name System",
          "Dynamic Name Service",
          "Domain Numbering Standard"
        ],
        "correctAnswer": "Domain Name System",
        "explanation": "DNS (Domain Name System) is the system that translates human-readable domain names into IP addresses.",
        "points": 10
      },
      {
        "id": "q2",
        "type": "single",
        "question": "What type of DNS record points a domain to an IPv4 address?",
        "options": [
          "CNAME",
          "A",
          "MX",
          "TXT"
        ],
        "correctAnswer": "A",
        "explanation": "An A record (Address Record) maps a domain name to an IPv4 address. AAAA records are used for IPv6.",
        "points": 10
      },
      {
        "id": "q3",
        "type": "single",
        "question": "What is DDNS used for?",
        "options": [
          "Making DNS queries faster",
          "Encrypting DNS traffic",
          "Automatically updating DNS when your IP address changes",
          "Creating subdomains"
        ],
        "correctAnswer": "Automatically updating DNS when your IP address changes",
        "explanation": "Dynamic DNS (DDNS) automatically updates your DNS records when your IP address changes, crucial for residential connections with dynamic IPs.",
        "points": 15
      },
      {
        "id": "q4",
        "type": "single",
        "question": "What does TTL stand for in DNS?",
        "options": [
          "Total Transfer Limit",
          "Time To Live",
          "Type To Load",
          "Transmission Time Lag"
        ],
        "correctAnswer": "Time To Live",
        "explanation": "TTL (Time To Live) specifies how long (in seconds) DNS resolvers should cache a record before querying again.",
        "points": 10
      },
      {
        "id": "q5",
        "type": "multiple",
        "question": "Which are valid DNS record types? (Select all that apply)",
        "options": [
          "A (IPv4 address)",
          "CNAME (alias)",
          "HTTP (web server)",
          "MX (mail server)"
        ],
        "correctAnswer": ["A (IPv4 address)", "CNAME (alias)", "MX (mail server)"],
        "explanation": "A, CNAME, and MX are all valid DNS record types. HTTP is not a DNS record type - it's a protocol.",
        "points": 20
      },
      {
        "id": "q6",
        "type": "short-answer",
        "question": "Why is DDNS important for home servers with residential internet connections?",
        "correctAnswer": "Residential ISPs typically assign dynamic IP addresses that change periodically. DDNS automatically updates DNS records when the IP changes, ensuring the domain always points to the current IP address without manual updates.",
        "explanation": "This is the key use case for DDNS: maintaining a working domain name even when your IP address changes. Without DDNS, you'd have to manually update DNS records every time your IP changed.",
        "points": 35
      }
    ]
  },
  "environment": {
    "setupSteps": [
      "Choose a DDNS provider (DuckDNS, No-IP, Dynu, etc.)",
      "Create an account and get your API token/credentials",
      "Decide where to run the DDNS client: server, router, or separate device",
      "Install curl or wget (usually pre-installed on Linux/macOS)",
      "For Windows, ensure you have PowerShell or curl.exe",
      "Optional: Register your own domain for custom domain setup"
    ],
    "commands": [
      "nslookup yourdomain.com  # Check DNS resolution",
      "dig yourdomain.com  # More detailed DNS query (Linux/macOS)",
      "curl ifconfig.me  # Get your current public IP",
      "ping yourdomain.com  # Verify domain resolves and is reachable",
      "nslookup -type=A yourdomain.com 8.8.8.8  # Query specific DNS server (Google DNS)"
    ],
    "troubleshooting": [
      {
        "issue": "Domain not resolving after adding DNS records",
        "solution": "DNS propagation can take time (5 min to 48 hours). Check: 1) TTL value (lower = faster updates). 2) Use whatsmydns.net to check global propagation. 3) Flush local DNS cache: ipconfig /flushdns (Windows) or sudo dscacheutil -flushcache (macOS). 4) Try querying a different DNS server: nslookup yourdomain.com 8.8.8.8"
      },
      {
        "issue": "DDNS not updating IP",
        "solution": "1) Check update client is running (ps aux | grep duck on Linux). 2) Verify correct API token/credentials. 3) Check cron job syntax or Task Scheduler settings. 4) Check DDNS provider's dashboard for last update time. 5) Some routers have built-in DDNS - make sure you're not running multiple clients."
      },
      {
        "issue": "CNAME pointing to DDNS but not working",
        "solution": "1) Verify CNAME record syntax (should point to DDNS hostname, not IP). 2) Check DDNS hostname itself resolves. 3) Some DNS providers don't allow CNAME at root domain (@) - use subdomain instead. 4) Wait for DNS propagation."
      }
    ]
  }
}
